<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />




  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXX"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'UA-XXXXX');
</script>
  
  
    <title>Datasets In GraphNeT &#8212; graphnet  documentation</title>

<style>
  dt:target {
    margin-top: 0;
    padding-top: 0;
  }


  /*
    .sig-prename {
     display: none;
  }
  */

  .py.class .sig-name,
  .py.function .sig-name,
  .py.method .sig-name,
  .py.exception .sig-name {
    color: #37474f;
    font-feature-settings: "kern";
    font-family: "Roboto Mono", "Courier New", Courier, monospace;
    font-weight: 700;
  }

  .py.class .sig-object,
  .py.function .sig-object,
  .py.method .sig-object,
  .py.exception .sig-object {
    padding: 1ex;
  }

  .py.class .sig-object,
  .py.function .sig-object,
  .py.exception .sig-object {
    border-top: 1px solid gray;
  }
  .py.method .sig-object {
    border-top: 1px solid lightgray;
  }

  .py.class .sig-object,
  .py.exception .sig-object {
    background: rgba(0,0,0,0.06);
  }
  .py.function .sig-object,
  .py.method .sig-object {
    background: rgba(0,0,0,0.03);
  }

  #eu-emblem {
    margin: 0;
  }

  #eu-emblem figcaption {
    display: none;
  }

</style>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=75810a84" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../_static/favicon.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data Conversion in GraphNeT" href="../data_conversion/data_conversion.html" />
    <link rel="prev" title="Models In GraphNeT" href="../models/models.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=indigo data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#datasets/datasets" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="graphnet  documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">GraphNeT</span>
          <span class="md-header-nav__topic"> Datasets In GraphNeT </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/graphnet-team/graphnet/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GraphNeT
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="../index.html" class="md-tabs__link">Documentation</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="graphnet documentation" class="md-nav__button md-logo">
      
        <img src="../_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="graphnet documentation">GraphNeT</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/graphnet-team/graphnet/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GraphNeT
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../installation/install.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../models/models.html" class="md-nav__link">Models In GraphNeT</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Datasets In GraphNeT </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Datasets In GraphNeT</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#datasets-datasets--page-root" class="md-nav__link">Datasets In GraphNeT</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#dataset" class="md-nav__link"><code class="code docutils literal notranslate"><span class="pre">Dataset</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#sqlitedataset-parquetdataset" class="md-nav__link"><code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> & <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code></a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#sqlitedataset-vs-parquetdataset" class="md-nav__link"><code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> vs. <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#choosing-a-subset-of-events-using-selection" class="md-nav__link">Choosing a subset of events using <cite>selection</cite></a>
        </li>
        <li class="md-nav__item"><a href="#adding-custom-labels" class="md-nav__link">Adding custom <code class="code docutils literal notranslate"><span class="pre">Label</span></code>s</a>
        </li>
        <li class="md-nav__item"><a href="#combining-multiple-datasets" class="md-nav__link">Combining Multiple Datasets</a>
        </li>
        <li class="md-nav__item"><a href="#implementing-a-new-dataset" class="md-nav__link">Implementing a new <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code></a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="#dataset" class="md-nav__link"><code class="code docutils literal notranslate"><span class="pre">Dataset</span></code></a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#sqlitedataset-parquetdataset" class="md-nav__link"><code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> & <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code></a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="#sqlitedataset-vs-parquetdataset" class="md-nav__link"><code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> vs. <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code></a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#choosing-a-subset-of-events-using-selection" class="md-nav__link">Choosing a subset of events using <cite>selection</cite></a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#adding-custom-labels" class="md-nav__link">Adding custom <code class="code docutils literal notranslate"><span class="pre">Label</span></code>s</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#combining-multiple-datasets" class="md-nav__link">Combining Multiple Datasets</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#implementing-a-new-dataset" class="md-nav__link">Implementing a new <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code></a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../data_conversion/data_conversion.html" class="md-nav__link">Data Conversion in GraphNeT</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../integration/integration.html" class="md-nav__link">Integrating New Experiments into GraphNeT</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../contribute/contribute.html" class="md-nav__link">Contributing To GraphNeT</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../api/graphnet.html" class="md-nav__link">API</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#datasets-datasets--page-root" class="md-nav__link">Datasets In GraphNeT</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#dataset" class="md-nav__link"><code class="code docutils literal notranslate"><span class="pre">Dataset</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#sqlitedataset-parquetdataset" class="md-nav__link"><code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> & <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code></a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#sqlitedataset-vs-parquetdataset" class="md-nav__link"><code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> vs. <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code></a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#choosing-a-subset-of-events-using-selection" class="md-nav__link">Choosing a subset of events using <cite>selection</cite></a>
        </li>
        <li class="md-nav__item"><a href="#adding-custom-labels" class="md-nav__link">Adding custom <code class="code docutils literal notranslate"><span class="pre">Label</span></code>s</a>
        </li>
        <li class="md-nav__item"><a href="#combining-multiple-datasets" class="md-nav__link">Combining Multiple Datasets</a>
        </li>
        <li class="md-nav__item"><a href="#implementing-a-new-dataset" class="md-nav__link">Implementing a new <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code></a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="datasets-in-graphnetgraphnet-header">
<h1 id="datasets-datasets--page-root">Datasets In GraphNeT<a class="reference internal" href="#datasets-datasets--page-root"><img alt="graphnet" class="align-bottom" src="../_images/favicon.svg" style="width: 50px; height: 50px;"/></a><a class="headerlink" href="#datasets-datasets--page-root" title="Link to this heading">¶</a></h1>
<section id="dataset">
<h2 id="dataset"><code class="code docutils literal notranslate"><span class="pre">Dataset</span></code><a class="headerlink" href="#dataset" title="Link to this heading">¶</a></h2>
<p>The <a class="reference external" href="https://graphnet-team.github.io/graphnet/_modules/graphnet/data/dataset/dataset.html#Dataset">Dataset</a> class in GraphNeT is a generic base class from which all Datasets in GraphNeT is expected to originate. <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> is based on <a class="reference external" href="https://pytorch.org/docs/stable/data.html#torch.utils.data.Dataset">torch.utils.data.Dataset</a>s, and is
is responsible for reading data from a file and preparing user-specified data representations as <a class="reference external" href="https://pytorch-geometric.readthedocs.io/en/latest/generated/torch_geometric.data.Data.html#torch_geometric.data.Data">torch_geometric.data.Data</a> objects.
<a class="reference external" href="https://graphnet-team.github.io/graphnet/api/graphnet.data.dataset.html#graphnet.data.dataset.Dataset">Dataset</a> provides structure and common functionality without ties to any specific file format.</p>
<p>Subclasses of <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> inherits the ability to be exported as a <a class="reference external" href="https://graphnet-team.github.io/graphnet/api/graphnet.utilities.config.dataset_config.html#graphnet.utilities.config.dataset_config.DatasetConfig">DatasetConfig</a> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">"dataset.yml"</span><span class="p">)</span>
</pre></div>
</div>
<p>This <code class="code docutils literal notranslate"><span class="pre">.yml</span></code> file will contain details about the path to the input data, the tables and columns that should be loaded, any selection that should be applied to data, etc.
In another session, you can then recreate the same <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.data.dataset</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dataset</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="s2">"dataset.yml"</span><span class="p">)</span>
</pre></div>
</div>
<p>You also have the option to define multiple datasets from the same data file(s) using a single <code class="code docutils literal notranslate"><span class="pre">DatasetConfig</span></code> file but with multiple selections:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"train"</span><span class="p">:</span> <span class="s2">"event_no % 2 == 0"</span><span class="p">,</span>
    <span class="s2">"test"</span><span class="p">:</span> <span class="s2">"event_no % 2 == 1"</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">"dataset.yml"</span><span class="p">)</span>
</pre></div>
</div>
<p>When you then re-create your dataset, it will appear as a <code class="code docutils literal notranslate"><span class="pre">Dict</span></code> containing your datasets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">datasets</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="s2">"dataset.yml"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">datasets</span>
<span class="p">{</span><span class="s2">"train"</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<span class="s2">"test"</span><span class="p">:</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">...</span><span class="p">),}</span>
</pre></div>
</div>
<p>You can also combine multiple selections into a single, named dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">..</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"train"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"event_no % 2 == 0 &amp; abs(injection_type) == 12"</span><span class="p">,</span>
        <span class="s2">"event_no % 2 == 0 &amp; abs(injection_type) == 14"</span><span class="p">,</span>
        <span class="s2">"event_no % 2 == 0 &amp; abs(injection_type) == 16"</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dataset</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">"dataset.yml"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">datasets</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="s2">"dataset.yml"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">datasets</span>
<span class="p">{</span><span class="s2">"train"</span><span class="p">:</span> <span class="n">EnsembleDataset</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
        <span class="p">(</span><span class="o">...</span><span class="p">)}</span>
</pre></div>
</div>
<p>You also have the option to select random subsets of your data using <code class="code docutils literal notranslate"><span class="pre">DatasetConfig</span></code> using the <code class="code docutils literal notranslate"><span class="pre">N</span> <span class="pre">random</span> <span class="pre">events</span> <span class="pre">~</span> <span class="pre">...</span></code>  syntax, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="o">..</span><span class="p">)</span>
<span class="n">dataset</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="s2">"1000 random events ~ abs(injection_type) == 14"</span>
</pre></div>
</div>
<p>Finally, you can also reference selections that you have stored as external CSV or JSON files on disk:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">selection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"train"</span><span class="p">:</span> <span class="s2">"50000 random events ~ train_selection.csv"</span><span class="p">,</span>
    <span class="s2">"test"</span><span class="p">:</span> <span class="s2">"test_selection.csv"</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<details>
<summary><b>Example of DataConfig</b></summary><p>GraphNeT comes with a pre-defined <code class="code docutils literal notranslate"><span class="pre">DatasetConfig</span></code> file for the small open-source dataset which can be found at <code class="code docutils literal notranslate"><span class="pre">graphnet/configs/datasets/training_example_data_sqlite.yml</span></code>.
It looks like so:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$GRAPHNET/data/examples/sqlite/prometheus/prometheus-events.db</span>
<span class="nt">graph_definition</span><span class="p">:</span>
<span class="nt">arguments</span><span class="p">:</span>
<span class="w">    </span><span class="nt">columns</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">detector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">arguments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prometheus</span>
<span class="w">    </span><span class="nt">dtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">    </span><span class="nt">nb_nearest_neighbours</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">    </span><span class="nt">node_definition</span><span class="p">:</span>
<span class="w">    </span><span class="nt">arguments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="w">    </span><span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodesAsPulses</span>
<span class="w">    </span><span class="nt">node_feature_names</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">sensor_pos_x</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">sensor_pos_y</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">sensor_pos_z</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">t</span><span class="p p-Indicator">]</span>
<span class="nt">class_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KNNGraph</span>
<span class="nt">pulsemaps</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">total</span>
<span class="nt">features</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sensor_pos_x</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sensor_pos_y</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sensor_pos_z</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">t</span>
<span class="nt">truth</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_energy</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_type</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_interaction_type</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_zenith</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_azimuth</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_bjorkenx</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_bjorkeny</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_position_x</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_position_y</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_position_z</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">injection_column_depth</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_lepton_1_type</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_hadron_1_type</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_lepton_1_position_x</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_lepton_1_position_y</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_lepton_1_position_z</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_hadron_1_position_x</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_hadron_1_position_y</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_hadron_1_position_z</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_lepton_1_direction_theta</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_lepton_1_direction_phi</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_hadron_1_direction_theta</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_hadron_1_direction_phi</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_lepton_1_energy</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary_hadron_1_energy</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">total_energy</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dummy_pid</span>
<span class="nt">index_column</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">event_no</span>
<span class="nt">truth_table</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mc_truth</span>
<span class="nt">seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">21</span>
<span class="nt">selection</span><span class="p">:</span>
<span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">event_no % 5 == 0</span>
<span class="nt">validation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">event_no % 5 == 1</span>
<span class="nt">train</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">event_no % 5 &gt; 1</span>
</pre></div>
</div>
</details></section>
<section id="sqlitedataset-parquetdataset">
<h2 id="sqlitedataset-parquetdataset"><code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> &amp; <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code><a class="headerlink" href="#sqlitedataset-parquetdataset" title="Link to this heading">¶</a></h2>
<p>The two specific implementations of <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> exists :</p>
<ul class="simple">
<li><p><a class="reference external" href="https://graphnet-team.github.io/graphnet/api/graphnet.data.parquet.parquet_dataset.html">ParquetDataset</a> : Constructs <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> from files created by <code class="code docutils literal notranslate"><span class="pre">ParquetWriter</span></code>.</p></li>
<li><p><a class="reference external" href="https://graphnet-team.github.io/graphnet/api/graphnet.data.sqlite.sqlite_dataset.html">SQLiteDataset</a> : Constructs <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> from files created by <code class="code docutils literal notranslate"><span class="pre">SQLiteWriter</span></code>.</p></li>
</ul>
<p>To instantiate a <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> from your files, you must specify at least the following:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">pulsemaps</span></code>: These are named fields in your Parquet files, or tables in your SQLite databases, which store one or more pulse series from which you would like to create a dataset. A pulse series represents the detector response, in the form of a series of PMT hits or pulses, in some time window, usually triggered by a single neutrino or atmospheric muon interaction. This is the data that will be served as input to the <cite>Model</cite>.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">truth_table</span></code>: The name of a table/array that contains the truth-level information associated with the pulse series, and should contain the truth labels that you would like to reconstruct or classify. Often this table will contain the true physical attributes of the primary particle — such as its true direction, energy, PID, etc. — and is therefore graph- or event-level (as opposed to the pulse series tables, which are node- or hit-level) truth information.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">features</span></code>: The names of the columns in your pulse series table(s) that you would like to include for training; they typically constitute the per-node/-hit features such as xyz-position of sensors, charge, and photon arrival times.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">truth</span></code>: The columns in your truth table/array that you would like to include in the dataset.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">graph_definition</span></code>: A <cite>GraphDefinition`that prepares the raw data from the `Dataset</cite> into your choice in data representation.</p></li>
</ul>
<p>After that, you can construct your <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> from a SQLite database with just a few lines of code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.data.dataset.sqlite.sqlite_dataset</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLiteDataset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.models.detector.prometheus</span><span class="w">  </span><span class="kn">import</span>  <span class="n">Prometheus</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.models.graphs</span><span class="w">  </span><span class="kn">import</span>  <span class="n">KNNGraph</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.models.graphs.nodes</span><span class="w">  </span><span class="kn">import</span>  <span class="n">NodesAsPulses</span>

<span class="n">graph_definition</span> <span class="o">=</span> <span class="n">KNNGraph</span><span class="p">(</span>
    <span class="n">detector</span><span class="o">=</span><span class="n">Prometheus</span><span class="p">(),</span>
    <span class="n">node_definition</span><span class="o">=</span><span class="n">NodesAsPulses</span><span class="p">(),</span>
    <span class="n">nb_nearest_neighbours</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">SQLiteDataset</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">"data/examples/sqlite/prometheus/prometheus-events.db"</span><span class="p">,</span>
    <span class="n">pulsemaps</span><span class="o">=</span><span class="s2">"total"</span><span class="p">,</span>
    <span class="n">truth_table</span><span class="o">=</span><span class="s2">"mc_truth"</span><span class="p">,</span>
    <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">"sensor_pos_x"</span><span class="p">,</span> <span class="s2">"sensor_pos_y"</span><span class="p">,</span> <span class="s2">"sensor_pos_z"</span><span class="p">,</span> <span class="s2">"t"</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">truth</span><span class="o">=</span><span class="p">[</span><span class="s2">"injection_energy"</span><span class="p">,</span> <span class="s2">"injection_zenith"</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">graph_definiton</span> <span class="o">=</span> <span class="n">graph_definition</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># torch_geometric.data.Data</span>
</pre></div>
</div>
<p>Or similarly for Parquet files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.data.dataset.parquet.parquet_dataset</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParquetDataset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.models.detector.prometheus</span><span class="w">  </span><span class="kn">import</span>  <span class="n">Prometheus</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.models.graphs</span><span class="w">  </span><span class="kn">import</span>  <span class="n">KNNGraph</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.models.graphs.nodes</span><span class="w">  </span><span class="kn">import</span>  <span class="n">NodesAsPulses</span>

<span class="n">graph_definition</span> <span class="o">=</span> <span class="n">KNNGraph</span><span class="p">(</span>
    <span class="n">detector</span><span class="o">=</span><span class="n">Prometheus</span><span class="p">(),</span>
    <span class="n">node_definition</span><span class="o">=</span><span class="n">NodesAsPulses</span><span class="p">(),</span>
    <span class="n">nb_nearest_neighbours</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">ParquetDataset</span><span class="p">(</span>
    <span class="n">path</span><span class="o">=</span><span class="s2">"data/examples/parquet/prometheus/prometheus-events.parquet"</span><span class="p">,</span>
    <span class="n">pulsemaps</span><span class="o">=</span><span class="s2">"total"</span><span class="p">,</span>
    <span class="n">truth_table</span><span class="o">=</span><span class="s2">"mc_truth"</span><span class="p">,</span>
    <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s2">"sensor_pos_x"</span><span class="p">,</span> <span class="s2">"sensor_pos_y"</span><span class="p">,</span> <span class="s2">"sensor_pos_z"</span><span class="p">,</span> <span class="s2">"t"</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">truth</span><span class="o">=</span><span class="p">[</span><span class="s2">"injection_energy"</span><span class="p">,</span> <span class="s2">"injection_zenith"</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">graph_definiton</span> <span class="o">=</span> <span class="n">graph_definition</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># torch_geometric.data.Data</span>
</pre></div>
</div>
<p>It’s then straightforward to create a <code class="code docutils literal notranslate"><span class="pre">DataLoader</span></code> for training, which will take care of batching, shuffling, and such:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.data.dataloader</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataLoader</span>

<span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The <code class="code docutils literal notranslate"><span class="pre">Dataset`s</span> <span class="pre">in</span> <span class="pre">GraphNeT</span> <span class="pre">use</span> <span class="pre">:code:`torch_geometric.data.Data</span></code> objects to present data as graphs, and graphs in GraphNeT are therefore compatible with PyG and its handling of graph objects.
By default, the following fields will be available in a graph built by <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> :</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">graph.x</span></code>: Node feature matrix with shape <code class="code docutils literal notranslate"><span class="pre">[num_nodes,</span> <span class="pre">num_features]</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">graph.edge_index</span></code>: Graph connectivity in <a class="reference external" href="https://pytorch.org/docs/stable/sparse.html#sparse-coo-docs">COO format</a> with shape <code class="code docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">num_edges]</span></code> and type <code class="code docutils literal notranslate"><span class="pre">torch.long</span></code> (by default this will be <code class="code docutils literal notranslate"><span class="pre">None</span></code>, i.e., the nodes will all be disconnected).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">graph.edge_attr</span></code>: Edge feature matrix with shape <code class="code docutils literal notranslate"><span class="pre">[num_edges,</span> <span class="pre">num_edge_features]</span></code> (will be <code class="code docutils literal notranslate"><span class="pre">None</span></code> by default).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">graph.features</span></code>: A copy of your <code class="code docutils literal notranslate"><span class="pre">features</span></code> argument to <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code>, see above.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">graph[truth_label]</span> <span class="pre">for</span> <span class="pre">truth_label</span> <span class="pre">in</span> <span class="pre">truth</span></code>: For each truth label in the <code class="code docutils literal notranslate"><span class="pre">truth</span></code> argument, the corresponding data is stored as a  <code class="code docutils literal notranslate"><span class="pre">[num_rows,</span> <span class="pre">1]</span></code> dimensional tensor. E.g., <code class="code docutils literal notranslate"><span class="pre">graph["energy"]</span> <span class="pre">=</span> <span class="pre">torch.tensor(26,</span> <span class="pre">dtype=torch.float)</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">graph[feature]</span> <span class="pre">for</span> <span class="pre">feature</span> <span class="pre">in</span> <span class="pre">features</span></code>: For each feature given in the <code class="code docutils literal notranslate"><span class="pre">features</span></code> argument, the corresponding data is stored as a  <code class="code docutils literal notranslate"><span class="pre">[num_rows,</span> <span class="pre">1]</span></code> dimensional tensor. E.g., <code class="code docutils literal notranslate"><span class="pre">graph["sensor_x"]</span> <span class="pre">=</span> <span class="pre">torch.tensor([100,</span> <span class="pre">-200,</span> <span class="pre">-300,</span> <span class="pre">200],</span> <span class="pre">dtype=torch.float)`</span></code></p></li>
</ul>
<section id="sqlitedataset-vs-parquetdataset">
<h3 id="sqlitedataset-vs-parquetdataset"><code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> vs. <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code><a class="headerlink" href="#sqlitedataset-vs-parquetdataset" title="Link to this heading">¶</a></h3>
<p>Besides working on different file formats, <code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> and <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code> have significant differences,
which may lead you to choose one over the other, depending on the problem at hand.</p>
<dl class="field-list simple">
<dt class="field-odd">SQLiteDataset<span class="colon">:</span></dt>
<dd class="field-odd"><p>SQLite provides fast random access to all events inside it. This makes plotting and subsampling your dataset particularly easy,
as you can use the <code class="code docutils literal notranslate"><span class="pre">selection</span></code> argument to <code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> to pick out exactly which events you want to use. However, one clear downside of SQLite is that its <strong>uncompressed</strong>,
meaning that it is intractable to use for very large datasets. Converting raw files to SQLite also takes a while, and query speed scales roughly as <code class="code docutils literal notranslate"><span class="pre">log(n)</span></code> where n is the number of rows in the table being queried.</p>
</dd>
<dt class="field-even">ParquetDataset<span class="colon">:</span></dt>
<dd class="field-even"><p>Parquet files produced by <code class="code docutils literal notranslate"><span class="pre">ParquetWriter</span></code> are compressed by ~x8 and in shuffled batches of 200.000 events (default) stored in seperate <code class="code docutils literal notranslate"><span class="pre">.parquet</span></code> files.
Unlike SQLite, the query speed remains constant regardless of dataset size, but does not offer fast random access. <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code> works on the merged files from <code class="code docutils literal notranslate"><span class="pre">ParquetWriter</span></code> and will read them serially file-by-file, row-by-row.
This means that the subsampling of your dataset needs to happen prior to the conversion to <code class="code docutils literal notranslate"><span class="pre">parquet</span></code>, unlike <cite>SQLiteDataset</cite> which allows for subsampling after conversion, due to it’s fast random access.
Conversion of files to <code class="code docutils literal notranslate"><span class="pre">parquet</span></code> is significantly faster than its <code class="code docutils literal notranslate"><span class="pre">SQLite</span></code> counterpart.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code> is scalable to ultra large datasets, but is more difficult to work with and has a higher memory consumption.</p>
<p><code class="code docutils literal notranslate"><span class="pre">SQLiteDataset</span></code> does not scale to very large datasets, but is easy to work with and has minimal memory consumption.</p>
</div>
</section>
</section>
<section id="choosing-a-subset-of-events-using-selection">
<h2 id="choosing-a-subset-of-events-using-selection">Choosing a subset of events using <cite>selection</cite><a class="headerlink" href="#choosing-a-subset-of-events-using-selection" title="Link to this heading">¶</a></h2>
<p>You can choose to include only a subset of the events in your data file(s) in your <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> by providing a <code class="code docutils literal notranslate"><span class="pre">selection</span></code> and <code class="code docutils literal notranslate"><span class="pre">index_column</span></code> argument.
<cite>selection</cite> is a list of integer event IDs that defines your subset and <code class="code docutils literal notranslate"><span class="pre">index_column</span></code> is the name of the column in your data that contains these IDs.</p>
<p>Suppose you wanted to include only events with IDs <code class="code docutils literal notranslate"><span class="pre">[10,</span> <span class="pre">5,</span> <span class="pre">100,</span> <span class="pre">21,</span> <span class="pre">5001]</span></code> in your dataset, and that your index column was named <code class="code docutils literal notranslate"><span class="pre">"event_no"</span></code>, then</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.data.sqlite</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLiteDataset</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">SQLiteDataset</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">index_column</span><span class="o">=</span><span class="s2">"event_no"</span><span class="p">,</span>
    <span class="n">selection</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">5001</span><span class="p">],</span>
<span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>
</div>
<p>would produce a <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> with only those five events.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For <code class="code docutils literal notranslate"><span class="pre">SQLiteDatase</span></code>, the <code class="code docutils literal notranslate"><span class="pre">selection</span></code> argument specifies individual events chosen for the dataset,
whereas for <code class="code docutils literal notranslate"><span class="pre">ParquetDataset</span></code>, the <code class="code docutils literal notranslate"><span class="pre">selection</span></code> argument specifies which batches are used in the dataset.</p>
</div>
</section>
<section id="adding-custom-labels">
<h2 id="adding-custom-labels">Adding custom <code class="code docutils literal notranslate"><span class="pre">Label</span></code>s<a class="headerlink" href="#adding-custom-labels" title="Link to this heading">¶</a></h2>
<p>Some specific applications of <code class="code docutils literal notranslate"><span class="pre">Model</span></code>s in GraphNeT might require truth labels that are not included by default in your truth table.
In these cases you can define a <a class="reference external" href="https://graphnet-team.github.io/graphnet/api/graphnet.training.labels.html#graphnet.training.labels.Label">Label</a> that calculates your label on the fly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch_geometric.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">Data</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.training.labels</span><span class="w"> </span><span class="kn">import</span> <span class="n">Label</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyCustomLabel</span><span class="p">(</span><span class="n">Label</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Class for producing my label."""</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Construct `MyCustomLabel`."""</span>
        <span class="c1"># Base class constructor</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">"my_custom_label"</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">Data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Compute label for `graph`."""</span>
        <span class="n">label</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># Your computations here.</span>
        <span class="k">return</span> <span class="n">label</span>
</pre></div>
</div>
<p>You can then pass your <code class="code docutils literal notranslate"><span class="pre">Label</span></code> to your <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">add_label</span><span class="p">(</span><span class="n">MyCustomLabel</span><span class="p">())</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">graph</span><span class="p">[</span><span class="s2">"my_custom_label"</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="combining-multiple-datasets">
<h2 id="combining-multiple-datasets">Combining Multiple Datasets<a class="headerlink" href="#combining-multiple-datasets" title="Link to this heading">¶</a></h2>
<p>You can combine multiple instances of <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> from GraphNeT into a single <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> by using the <a class="reference external" href="https://graphnet-team.github.io/graphnet/api/graphnet.data.dataset.html#graphnet.data.dataset.EnsembleDataset">EnsembleDataset</a> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">EnsembleDataset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.data.parquet</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParquetDataset</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphnet.data.sqlite</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLiteDataset</span>

<span class="n">dataset_1</span> <span class="o">=</span> <span class="n">SQLiteDataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">dataset_2</span> <span class="o">=</span> <span class="n">SQLiteDataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">dataset_3</span> <span class="o">=</span> <span class="n">ParquetDataset</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">ensemble_dataset</span> <span class="o">=</span> <span class="n">EnsembleDataset</span><span class="p">([</span><span class="n">dataset_1</span><span class="p">,</span> <span class="n">dataset_2</span><span class="p">,</span> <span class="n">dataset_3</span><span class="p">])</span>
</pre></div>
</div>
<p>You can find a detailed example <a class="reference external" href="https://github.com/graphnet-team/graphnet/blob/main/examples/02_data/04_ensemble_dataset.py">here</a> .</p>
</section>
<section id="implementing-a-new-dataset">
<h2 id="implementing-a-new-dataset">Implementing a new <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code><a class="headerlink" href="#implementing-a-new-dataset" title="Link to this heading">¶</a></h2>
<p>You can extend GraphNeT to work on new file formats by implementing a subclass of <code class="code docutils literal notranslate"><span class="pre">Dataset</span></code> that works on the files you have.</p>
<p>To do so, all you need to do is to implement the <code class="code docutils literal notranslate"><span class="pre">abstractmethod</span></code> <a class="reference external" href="https://graphnet-team.github.io/graphnet/_modules/graphnet/data/dataset/dataset.html#Dataset.query_table">query_table</a>
which defines the logic of retrieving information from your files.</p>
<p>The GraphNeT development team is willing to support such efforts, so please consider reaching out to us if you need help.</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="../models/models.html" title="Models In GraphNeT"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Models In GraphNeT </span>
              </div>
            </a>
          
          
            <a href="../data_conversion/data_conversion.html" title="Data Conversion in GraphNeT"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> Data Conversion in GraphNeT </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2021-2026, GraphNeT team.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>